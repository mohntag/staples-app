<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="theme-color" content="#ffffff">
<link rel="manifest" href="manifest.webmanifest">
<title>Staples — Quick Links</title>
<style>
  :root{--r:14px}
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;padding:16px;max-width:780px}
  h1{font-size:22px;margin:0}
  .small{font-size:12px;color:#666}
  .row{display:flex;gap:8px;margin:12px 0;flex-wrap:wrap}
  input{flex:1;padding:10px;border:1px solid #ddd;border-radius:var(--r)}
  button{padding:10px 12px;border:1px solid #ddd;border-radius:var(--r);background:#fff;cursor:pointer}
  #grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px;margin-top:12px}
  .card{padding:14px;border:1px solid #eee;border-radius:var(--r);text-align:left}
  .name{font-weight:600;margin-bottom:6px}
  .host{font-size:12px;color:#666}
  .actions{display:flex;gap:6px;margin-top:10px;flex-wrap:wrap}
</style>
</head>
<body>
<h1>Staples</h1>
<small class="small">links v12</small>

<div class="row">
  <input id="search" placeholder="Search links…" />
</div>

<div class="row">
  <input id="newName" placeholder="Add a link (e.g., Grind — House Blend Pods)" />
  <input id="newUrl" placeholder="https://example.com/product" />
  <button id="add">Add</button>
  <button id="importDemo">Import demo</button>
  <button id="export">Export</button>
</div>

<div id="grid"></div>

<script>
const SKEY = 'staples.links.v1';
let links = load();

function load(){ try { return JSON.parse(localStorage.getItem(SKEY)) || []; } catch(e){ return []; } }
function save(){ localStorage.setItem(SKEY, JSON.stringify(links)); render(); }
function host(u){ try { return new URL(u).hostname.replace(/^www\\./,''); } catch(e){ return ''; } }
function uid(){ return Math.random().toString(36).slice(2,9); }

function render(){
  const q = (document.getElementById('search').value||'').toLowerCase();
  const grid = document.getElementById('grid');
  const list = links
    .filter(l => l.name.toLowerCase().includes(q) || (l.url||'').toLowerCase().includes(q));
  grid.innerHTML = list.map((l, idx) => `
    <div class="card">
      <div class="name">${l.name}</div>
      <div class="host">${host(l.url)}</div>
      <div class="actions">
        <button onclick="openLink(${idx})">Open</button>
        <button onclick="editLink(${idx})">✏️ Edit</button>
        <button onclick="deleteLink(${idx})">❌ Delete</button>
      </div>
    </div>
  `).join('') || '<p class="small">No links yet — add above.</p>';
}

function openLink(i){
  const l = links[i]; if(!l || !l.url) return alert('No URL set.');
  window.open(l.url, '_blank');
}

function addLink(name, url){
  name = (name||'').trim();
  url = (url||'').trim();
  if(!name || !url) return;
  const idx = links.findIndex(x => x.name.toLowerCase() === name.toLowerCase());
  if(idx >= 0){ links[idx].url = url; } else { links.push({ id: uid(), name, url }); }
  save();
}

function editLink(i){
  const l = links[i]; if(!l) return;
  const newName = prompt('Name', l.name);
  const newUrl  = prompt('URL', l.url);
  if(newName !== null && newName.trim()) l.name = newName.trim();
  if(newUrl  !== null && newUrl.trim())  l.url  = newUrl.trim();
  save();
}

function deleteLink(i){
  if(!confirm('Delete this link?')) return;
  links.splice(i,1);
  save();
}

function importDemo(){
  const demo = [
    { name:"Grind — House Blend Pods", url:"https://grind.co.uk/products/grindnespressopodsbulk" },
    { name:"Grind — House Decaf Pods", url:"https://grind.co.uk/products/grindnespressopodsbulk" },
    { name:"Organic Walnut Halves",    url:"https://www.nutsinbulk.co.uk/product/organic-walnut-halves" },
    { name:"Whole Pecan Halves",       url:"https://www.nutsinbulk.co.uk/product/whole-pecan-halves" },
    { name:"Blanched Hazelnut Pieces", url:"https://www.nutsinbulk.co.uk/product/blanched-hazelnut-pieces" },
    { name:"Whole Cashew Nuts",        url:"https://www.nutsinbulk.co.uk/product/whole-cashew-nuts" },
    { name:"Pine Nuts Kernels",        url:"https://www.nutsinbulk.co.uk/product/pine-nuts-kernels" },
    { name:"Sunflower Seeds",          url:"https://www.nutsinbulk.co.uk/product/sunflower-seeds" }
  ];
  demo.forEach(d => addLink(d.name, d.url));
  alert('Imported demo links.');
}

function exportLinks(){
  const text = JSON.stringify(links, null, 2);
  navigator.clipboard.writeText(text).then(()=> alert('Exported to clipboard.'));
}

document.getElementById('add').onclick = () => {
  addLink(document.getElementById('newName').value, document.getElementById('newUrl').value);
  document.getElementById('newName').value='';
  document.getElementById('newUrl').value='';
};
document.getElementById('importDemo').onclick = importDemo;
document.getElementById('export').onclick = exportLinks;
document.getElementById('search').oninput = render;

render();
</script>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js').then(reg => {
    reg.update();
    navigator.serviceWorker.addEventListener('controllerchange', () => location.reload());
  });
}
</script>
</body>
</html>
